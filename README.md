# Navigator - 引用导向的知识管理系统

## 🎯 核心理念

我曾经是纯文本的忠实拥趸，想实现的大一统是在格式层面上统一为纯文本。

但是现实是信息很难用全部用纯文本来表示的，而且纯文本也不是在任何时候都能很好得发挥作用的（其他格式存在必然有它们的道理）

在我做笔记的时候，我会引用到各种各样的资源，或许是网页链接，或许是一个 pdf 里的一段摘要

所以，我就在想，有没有以引用为根基（也就是广义的批注）为基本元素的信息收集系统？
我们日常产生的动机它产生必然有其原因，这个因果关系何尝不是一种批注？

这个信息库在精炼之后就能得到专属于自己的知识库

要充分利用这样的知识库，要做的最重要的就是打通关系的创建和跳转通路

我想要处理的第一个信息媒介是 PDF （这也是这个项目需要做的任务）
我们可以设置各种视图(view)，比如预览视图(正常的 pdf 显示方式)、大纲视图、纯文本视图
还可以设置各种跳转方式，比如说预览视图下就可以按 layout detect 得到的区域按空间方位跳转，比如纯文本视图可以以句为单位跳转
跳转方式和视图不一定要绑定，这是后面要详细讨论的设计

最重要的是我需要能用键盘控制整个软件，vim-friendly 是我一直以来的设计理念

---

## 📖 文档指南

- **[📖 用户使用指南](docs/user-guide.md)** - 完整的功能使用说明，快速上手所有特性
- **[📋 Electron 开发指南](docs/electron-development-guide.md)** - 完整的开发文档，适合第一次接触 Electron 的开发者
- **[🏗️ 技术架构设计](architecture.md)** - 系统架构和技术选型详解

## 🚀 快速开始

### 前置要求

- Node.js >= 18
- npm >= 9

### 安装依赖

```bash
npm install
```

### 启动开发环境

```bash
npm run dev
```

这会同时启动Vite开发服务器和Electron应用。

### 体验功能

1. **PDF查看器模式**：
   - 使用 `Ctrl+O` 打开PDF文件
   - 支持完整的vim式键盘导航

2. **布局分析模式**：
   - 点击右上角"布局视图"按钮切换
   - 使用 `Ctrl+L` 加载布局分析文件
   - **新功能：智能叠加显示** - 布局检测框直接显示在PDF内容上，不同颜色表示不同类型（标题、文本、列表、表格、图片等）
   - 可以直接加载 `examples/` 目录下的示例文件：
     - `sample-model.json` - 布局检测模型数据
     - `sample-middle.json` - 中间处理数据
     - `sample-content-list.json` - 结构化内容数据

## 🎹 键盘快捷键

### 基础导航
- `j` - 下一页
- `k` - 上一页  
- `h` - 向左
- `l` - 向右
- `gg` - 第一页
- `G` - 最后一页

### 视图切换
- `1` - 预览视图
- `2` - 大纲视图 (开发中)
- `3` - 纯文本视图 (开发中)

### 命令模式
- `:` - 进入命令模式
- `:q` - 退出应用
- `:123` - 跳转到第123页
- `:view outline` - 切换视图 (开发中)

### 布局分析模式
- `vl` - 切换布局视图
- `vo` - 切换文档大纲
- `vb` - 切换布局框显示
- `vt` - 切换文本内容显示
- `pj` - 布局视图下一页
- `pk` - 布局视图上一页

### 其他操作
- `Ctrl+O` - 打开PDF文件
- `Ctrl+L` - 加载布局分析文件
- `?` - 显示/隐藏帮助
- `i` - 进入插入模式 (批注功能开发中)
- `Esc` - 返回普通模式

## 🏗️ 项目结构

```
navigator/
├── src/
│   ├── main/           # Electron主进程
│   │   ├── main.ts     # 主进程入口
│   │   └── preload.ts  # Preload脚本
│   ├── components/     # React组件
│   │   ├── PDFViewer.tsx    # PDF查看器
│   │   ├── StatusBar.tsx    # 状态栏
│   │   └── HelpPanel.tsx    # 帮助面板
│   ├── hooks/          # 自定义Hook
│   │   └── useKeyboard.ts   # vim-style键盘控制
│   ├── store/          # 状态管理
│   │   └── navigation.ts    # 导航状态
│   ├── types/          # TypeScript类型
│   └── App.tsx         # 主应用组件
├── docs/               # 文档目录
│   └── electron-development-guide.md  # 开发指南
├── architecture.md     # 技术架构
└── package.json        # 项目配置
```

## 💡 核心特性

### ✅ 已实现
- **vim-style键盘控制** - 完全键盘驱动的操作体验
- **PDF查看器** - 基于PDF.js的高质量PDF渲染
- **布局分析器** - 文档布局检测和可视化系统
- **智能布局叠加** - 布局检测框直接叠加在PDF内容上，支持多种布局类型的颜色区分
- **多视图支持** - PDF视图和布局分析视图的无缝切换
- **多模式支持** - Normal/Insert/Command模式切换
- **状态栏显示** - 实时显示当前模式和文档信息
- **快捷键帮助** - 内置快捷键参考面板
- **文件加载** - 支持PDF文件和布局分析JSON文件
- **错误处理** - 完善的PDF加载错误处理和用户反馈
- **示例数据** - 提供完整的示例数据用于功能演示

### 🚧 开发中
- **批注系统** - 广义批注和引用管理
- **多视图支持** - 大纲视图、纯文本视图等
- **智能跳转** - 基于内容结构的空间和语义导航
- **引用网络** - 文档间的关系构建和可视化
- **知识图谱** - 个人知识库的智能组织

### 🎯 技术栈

- **前端**: React 18 + TypeScript + Tailwind CSS
- **桌面**: Electron + Vite
- **PDF处理**: PDF.js + 高级布局分析
- **状态管理**: Zustand
- **构建工具**: Vite + TypeScript

## 🔬 高级PDF布局分析

Navigator集成了先进的PDF结构化分析技术，基于[MinerU](https://mineru.readthedocs.io/en/latest/user_guide/pipe_result.html)等项目的设计理念，实现了全面的文档结构理解：

### 📊 核心能力

- **智能布局检测**: 自动识别文档的版面结构，区分垂直和水平布局
- **多模态内容识别**: 精确识别文本、标题、图像、表格、公式等不同类型的内容
- **层次化数据结构**: 采用4层嵌套结构（页面→块→行→片段）完整描述PDF内容
- **实时可视化**: 布局分析结果实时叠加显示，不同颜色标识不同内容类型
- **置信度评估**: 每个识别结果都包含置信度分数，支持质量控制

### 🎨 可视化功能

- **布局框显示**: 绿色虚线框显示整体布局结构
- **内容块标识**: 
  - 🟦 蓝色 - 正文文本
  - 🟩 绿色 - 标题
  - 🟧 橙色 - 图像区域
  - 🟥 红色 - 表格区域
  - 🟪 紫色 - 数学公式
- **交互式选择**: 点击任意内容块查看详细信息
- **片段级分析**: 可展开显示最小语义单元的识别结果

### 📈 质量指标

- **布局检测准确率**: 版面分析的准确程度
- **文本提取完整率**: 文本内容识别的完整性
- **结构一致性**: 文档结构识别的一致性
- **总体置信度**: 整页分析结果的综合评分

### 🛠️ 技术实现

基于类似MinerU的处理管道，采用以下数据结构：

```typescript
// 页面信息
interface PageInfo {
  page_idx: number;           // 页码
  page_size: [number, number]; // 页面尺寸
  layout_bboxes: LayoutBox[];  // 布局框
  para_blocks: Block[];       // 段落块
  images: ImageBlock[];       // 图像块
  tables: TableBlock[];       // 表格块
  interline_equations: EquationBlock[]; // 公式块
}

// 块结构 (支持嵌套)
interface Block {
  type: BlockType;           // 块类型
  bbox: BoundingBox;         // 边界框
  lines: Line[];            // 包含的行
  confidence?: number;       // 置信度
}

// 最小语义单元
interface Span {
  type: SpanType;           // 片段类型
  content: string;          // 文本内容
  bbox: BoundingBox;        // 位置信息
  style?: TextStyle;        // 样式信息
}
```

详细的技术文档和实现指南请参考：**[📋 PDF高级布局分析技术文档](docs/pdf-layout-analysis.md)**

## 🛠️ 开发脚本

```bash
# 完整开发环境 (推荐)
npm run dev

# 单独启动前端开发服务器
npm run dev:vite

# 编译并启动Electron
npm run dev:electron

# 构建生产版本
npm run build

# 打包桌面应用
npx electron-builder
```

## 🐛 调试和开发

### 渲染进程调试
- 右键 → 检查元素 或 F12 打开开发者工具
- 在React组件中使用 `console.log` 

### 主进程调试
- 主进程日志会显示在启动应用的终端中
- 使用 `console.log` 在 `src/main/main.ts` 中调试

### 常见问题
详见 [Electron开发指南](docs/electron-development-guide.md#常见问题解决)

## 🎨 设计原则

1. **键盘优先** - 所有操作都可以通过键盘完成
2. **vim友好** - 采用vim-style的操作逻辑
3. **引用导向** - 以引用和批注为核心构建知识网络
4. **多视图** - 支持不同的信息呈现和导航方式
5. **渐进增强** - 从基础功能开始逐步构建完整系统

## 🚀 未来规划

### 短期目标 (1-2个月)
- [ ] 完善PDF批注功能
- [ ] 实现大纲视图
- [ ] 添加纯文本视图
- [ ] 优化键盘导航体验

### 中期目标 (3-6个月)
- [ ] 引用系统设计和实现
- [ ] 多文档管理
- [ ] 搜索和索引功能
- [ ] 导出和分享功能

### 长期目标 (6个月+)
- [ ] 网页内容支持
- [ ] 图片和多媒体批注
- [ ] 协作功能
- [ ] 移动端支持
- [ ] AI辅助的内容理解和关联

## 🤝 贡献

这个项目目前处于早期开发阶段，欢迎任何形式的贡献：

- 🐛 报告bug
- 💡 提出新功能建议  
- 📝 改进文档
- 💻 提交代码

## 📄 许可证

MIT License - 详见 LICENSE 文件

---

*这个demo展示了基于引用导向知识管理理念的核心功能实现，为完整的引用导航器系统奠定了基础。*
